/**
 * Copyright (C) 2015 - present by OpenGamma Inc. and the OpenGamma group of companies
 * <p>
 * Please see distribution for license.
 */
package com.opengamma.strata.finance.credit.type;

import com.opengamma.strata.basics.BuySell;
import com.opengamma.strata.basics.currency.Currency;
import com.opengamma.strata.basics.date.BusinessDayAdjustment;
import com.opengamma.strata.basics.date.BusinessDayConvention;
import com.opengamma.strata.basics.date.DayCount;
import com.opengamma.strata.basics.date.HolidayCalendar;
import com.opengamma.strata.basics.schedule.Frequency;
import com.opengamma.strata.basics.schedule.StubConvention;
import com.opengamma.strata.collect.id.StandardId;
import com.opengamma.strata.finance.Convention;
import com.opengamma.strata.finance.TradeInfo;
import com.opengamma.strata.finance.credit.CreditDefaultSwap;
import com.opengamma.strata.finance.credit.CreditDefaultSwapTrade;
import com.opengamma.strata.finance.credit.common.RedCode;
import com.opengamma.strata.finance.credit.fee.FeeLeg;
import com.opengamma.strata.finance.credit.general.GeneralTerms;
import com.opengamma.strata.finance.credit.general.reference.SeniorityLevel;
import com.opengamma.strata.finance.credit.protection.ProtectionTerms;
import com.opengamma.strata.finance.credit.protection.RestructuringClause;
import org.joda.beans.Bean;
import org.joda.beans.BeanDefinition;
import org.joda.beans.ImmutableBean;
import org.joda.beans.ImmutableValidator;
import org.joda.beans.JodaBeanUtils;
import org.joda.beans.MetaProperty;
import org.joda.beans.Property;
import org.joda.beans.PropertyDefinition;
import org.joda.beans.impl.direct.DirectFieldsBeanBuilder;
import org.joda.beans.impl.direct.DirectMetaBean;
import org.joda.beans.impl.direct.DirectMetaProperty;
import org.joda.beans.impl.direct.DirectMetaPropertyMap;

import java.io.Serializable;
import java.time.LocalDate;
import java.time.Period;
import java.util.Map;
import java.util.NoSuchElementException;
import java.util.Set;

@BeanDefinition
public final class StandardSingleNameConvention
    implements Convention, ImmutableBean, Serializable {

  @PropertyDefinition(validate = "notNull")
  private final Currency currency;

  @PropertyDefinition(validate = "notNull")
  private final DayCount dayCount;

  @PropertyDefinition(validate = "notNull")
  private final BusinessDayConvention dayConvention;

  @PropertyDefinition(validate = "notNull")
  private final Frequency paymentFrequency;

  @PropertyDefinition(validate = "notNull")
  private final boolean payAccOnDefault;

  @PropertyDefinition(validate = "notNull")
  private final HolidayCalendar calendar;

  @PropertyDefinition(validate = "notNull")
  private final int stepIn;

  @PropertyDefinition(get = "field")
  private final StubConvention stubConvention;


  //-------------------------------------------------------------------------
  @ImmutableValidator
  private void validate() {
    //   ArgChecker.isTrue(fixedLeg.getCurrency().equals(floatingLeg.getCurrency()), "Conventions must have same currency");
  }


  //-------------------------------------------------------------------------

  public CreditDefaultSwapTrade toTrade(
      StandardId id,
      LocalDate tradeDate,
      Period period,
      BuySell buySell,
      double notional,
      double coupon,
      RedCode referenceEntityId,
      String referenceEntityName,
      SeniorityLevel seniorityLevel,
      RestructuringClause restructuringClause
  ) {
//    ArgChecker.inOrderOrEqual(tradeDate, startDate, "tradeDate", "startDate");

    LocalDate effectiveDate = tradeDate; // IMM roll
    LocalDate maturityDate = tradeDate.plus(period);
    LocalDate stepInDate = tradeDate.plusDays(stepIn);
    return CreditDefaultSwapTrade.of(
        id,
        TradeInfo
            .builder()
            .tradeDate(tradeDate) // do I need settle date here?
            .build(),
        CreditDefaultSwap.of(
            GeneralTerms.singleName(
                effectiveDate,
                maturityDate,
                BusinessDayAdjustment.of(
                    dayConvention,
                    calendar
                ),
                referenceEntityId,
                referenceEntityName,
                currency,
                seniorityLevel
            ),
            FeeLeg.of(
                notional,
                payAccOnDefault,
                stepInDate,
                dayCount,
                paymentFrequency,
                stubConvention
            ),
            ProtectionTerms.of(
                notional,
                restructuringClause
            )
        )
    );
  }
  //------------------------- AUTOGENERATED START -------------------------
  ///CLOVER:OFF
  /**
   * The meta-bean for {@code StandardSingleNameConvention}.
   * @return the meta-bean, not null
   */
  public static StandardSingleNameConvention.Meta meta() {
    return StandardSingleNameConvention.Meta.INSTANCE;
  }

  static {
    JodaBeanUtils.registerMetaBean(StandardSingleNameConvention.Meta.INSTANCE);
  }

  /**
   * The serialization version id.
   */
  private static final long serialVersionUID = 1L;

  /**
   * Returns a builder used to create an instance of the bean.
   * @return the builder, not null
   */
  public static StandardSingleNameConvention.Builder builder() {
    return new StandardSingleNameConvention.Builder();
  }

  private StandardSingleNameConvention(
      Currency currency,
      DayCount dayCount,
      BusinessDayConvention dayConvention,
      Frequency paymentFrequency,
      boolean payAccOnDefault,
      HolidayCalendar calendar,
      int stepIn,
      StubConvention stubConvention) {
    JodaBeanUtils.notNull(currency, "currency");
    JodaBeanUtils.notNull(dayCount, "dayCount");
    JodaBeanUtils.notNull(dayConvention, "dayConvention");
    JodaBeanUtils.notNull(paymentFrequency, "paymentFrequency");
    JodaBeanUtils.notNull(payAccOnDefault, "payAccOnDefault");
    JodaBeanUtils.notNull(calendar, "calendar");
    JodaBeanUtils.notNull(stepIn, "stepIn");
    this.currency = currency;
    this.dayCount = dayCount;
    this.dayConvention = dayConvention;
    this.paymentFrequency = paymentFrequency;
    this.payAccOnDefault = payAccOnDefault;
    this.calendar = calendar;
    this.stepIn = stepIn;
    this.stubConvention = stubConvention;
    validate();
  }

  @Override
  public StandardSingleNameConvention.Meta metaBean() {
    return StandardSingleNameConvention.Meta.INSTANCE;
  }

  @Override
  public <R> Property<R> property(String propertyName) {
    return metaBean().<R>metaProperty(propertyName).createProperty(this);
  }

  @Override
  public Set<String> propertyNames() {
    return metaBean().metaPropertyMap().keySet();
  }

  //-----------------------------------------------------------------------
  /**
   * Gets the currency.
   * @return the value of the property, not null
   */
  public Currency getCurrency() {
    return currency;
  }

  //-----------------------------------------------------------------------
  /**
   * Gets the dayCount.
   * @return the value of the property, not null
   */
  public DayCount getDayCount() {
    return dayCount;
  }

  //-----------------------------------------------------------------------
  /**
   * Gets the dayConvention.
   * @return the value of the property, not null
   */
  public BusinessDayConvention getDayConvention() {
    return dayConvention;
  }

  //-----------------------------------------------------------------------
  /**
   * Gets the paymentFrequency.
   * @return the value of the property, not null
   */
  public Frequency getPaymentFrequency() {
    return paymentFrequency;
  }

  //-----------------------------------------------------------------------
  /**
   * Gets the payAccOnDefault.
   * @return the value of the property, not null
   */
  public boolean isPayAccOnDefault() {
    return payAccOnDefault;
  }

  //-----------------------------------------------------------------------
  /**
   * Gets the calendar.
   * @return the value of the property, not null
   */
  public HolidayCalendar getCalendar() {
    return calendar;
  }

  //-----------------------------------------------------------------------
  /**
   * Gets the stepIn.
   * @return the value of the property, not null
   */
  public int getStepIn() {
    return stepIn;
  }

  //-----------------------------------------------------------------------
  /**
   * Returns a builder that allows this bean to be mutated.
   * @return the mutable builder, not null
   */
  public Builder toBuilder() {
    return new Builder(this);
  }

  @Override
  public boolean equals(Object obj) {
    if (obj == this) {
      return true;
    }
    if (obj != null && obj.getClass() == this.getClass()) {
      StandardSingleNameConvention other = (StandardSingleNameConvention) obj;
      return JodaBeanUtils.equal(getCurrency(), other.getCurrency()) &&
          JodaBeanUtils.equal(getDayCount(), other.getDayCount()) &&
          JodaBeanUtils.equal(getDayConvention(), other.getDayConvention()) &&
          JodaBeanUtils.equal(getPaymentFrequency(), other.getPaymentFrequency()) &&
          (isPayAccOnDefault() == other.isPayAccOnDefault()) &&
          JodaBeanUtils.equal(getCalendar(), other.getCalendar()) &&
          (getStepIn() == other.getStepIn()) &&
          JodaBeanUtils.equal(stubConvention, other.stubConvention);
    }
    return false;
  }

  @Override
  public int hashCode() {
    int hash = getClass().hashCode();
    hash = hash * 31 + JodaBeanUtils.hashCode(getCurrency());
    hash = hash * 31 + JodaBeanUtils.hashCode(getDayCount());
    hash = hash * 31 + JodaBeanUtils.hashCode(getDayConvention());
    hash = hash * 31 + JodaBeanUtils.hashCode(getPaymentFrequency());
    hash = hash * 31 + JodaBeanUtils.hashCode(isPayAccOnDefault());
    hash = hash * 31 + JodaBeanUtils.hashCode(getCalendar());
    hash = hash * 31 + JodaBeanUtils.hashCode(getStepIn());
    hash = hash * 31 + JodaBeanUtils.hashCode(stubConvention);
    return hash;
  }

  @Override
  public String toString() {
    StringBuilder buf = new StringBuilder(288);
    buf.append("StandardSingleNameConvention{");
    buf.append("currency").append('=').append(getCurrency()).append(',').append(' ');
    buf.append("dayCount").append('=').append(getDayCount()).append(',').append(' ');
    buf.append("dayConvention").append('=').append(getDayConvention()).append(',').append(' ');
    buf.append("paymentFrequency").append('=').append(getPaymentFrequency()).append(',').append(' ');
    buf.append("payAccOnDefault").append('=').append(isPayAccOnDefault()).append(',').append(' ');
    buf.append("calendar").append('=').append(getCalendar()).append(',').append(' ');
    buf.append("stepIn").append('=').append(getStepIn()).append(',').append(' ');
    buf.append("stubConvention").append('=').append(JodaBeanUtils.toString(stubConvention));
    buf.append('}');
    return buf.toString();
  }

  //-----------------------------------------------------------------------
  /**
   * The meta-bean for {@code StandardSingleNameConvention}.
   */
  public static final class Meta extends DirectMetaBean {
    /**
     * The singleton instance of the meta-bean.
     */
    static final Meta INSTANCE = new Meta();

    /**
     * The meta-property for the {@code currency} property.
     */
    private final MetaProperty<Currency> currency = DirectMetaProperty.ofImmutable(
        this, "currency", StandardSingleNameConvention.class, Currency.class);
    /**
     * The meta-property for the {@code dayCount} property.
     */
    private final MetaProperty<DayCount> dayCount = DirectMetaProperty.ofImmutable(
        this, "dayCount", StandardSingleNameConvention.class, DayCount.class);
    /**
     * The meta-property for the {@code dayConvention} property.
     */
    private final MetaProperty<BusinessDayConvention> dayConvention = DirectMetaProperty.ofImmutable(
        this, "dayConvention", StandardSingleNameConvention.class, BusinessDayConvention.class);
    /**
     * The meta-property for the {@code paymentFrequency} property.
     */
    private final MetaProperty<Frequency> paymentFrequency = DirectMetaProperty.ofImmutable(
        this, "paymentFrequency", StandardSingleNameConvention.class, Frequency.class);
    /**
     * The meta-property for the {@code payAccOnDefault} property.
     */
    private final MetaProperty<Boolean> payAccOnDefault = DirectMetaProperty.ofImmutable(
        this, "payAccOnDefault", StandardSingleNameConvention.class, Boolean.TYPE);
    /**
     * The meta-property for the {@code calendar} property.
     */
    private final MetaProperty<HolidayCalendar> calendar = DirectMetaProperty.ofImmutable(
        this, "calendar", StandardSingleNameConvention.class, HolidayCalendar.class);
    /**
     * The meta-property for the {@code stepIn} property.
     */
    private final MetaProperty<Integer> stepIn = DirectMetaProperty.ofImmutable(
        this, "stepIn", StandardSingleNameConvention.class, Integer.TYPE);
    /**
     * The meta-property for the {@code stubConvention} property.
     */
    private final MetaProperty<StubConvention> stubConvention = DirectMetaProperty.ofImmutable(
        this, "stubConvention", StandardSingleNameConvention.class, StubConvention.class);
    /**
     * The meta-properties.
     */
    private final Map<String, MetaProperty<?>> metaPropertyMap$ = new DirectMetaPropertyMap(
        this, null,
        "currency",
        "dayCount",
        "dayConvention",
        "paymentFrequency",
        "payAccOnDefault",
        "calendar",
        "stepIn",
        "stubConvention");

    /**
     * Restricted constructor.
     */
    private Meta() {
    }

    @Override
    protected MetaProperty<?> metaPropertyGet(String propertyName) {
      switch (propertyName.hashCode()) {
        case 575402001:  // currency
          return currency;
        case 1905311443:  // dayCount
          return dayCount;
        case 1710876717:  // dayConvention
          return dayConvention;
        case 863656438:  // paymentFrequency
          return paymentFrequency;
        case -988493655:  // payAccOnDefault
          return payAccOnDefault;
        case -178324674:  // calendar
          return calendar;
        case -892367599:  // stepIn
          return stepIn;
        case -31408449:  // stubConvention
          return stubConvention;
      }
      return super.metaPropertyGet(propertyName);
    }

    @Override
    public StandardSingleNameConvention.Builder builder() {
      return new StandardSingleNameConvention.Builder();
    }

    @Override
    public Class<? extends StandardSingleNameConvention> beanType() {
      return StandardSingleNameConvention.class;
    }

    @Override
    public Map<String, MetaProperty<?>> metaPropertyMap() {
      return metaPropertyMap$;
    }

    //-----------------------------------------------------------------------
    /**
     * The meta-property for the {@code currency} property.
     * @return the meta-property, not null
     */
    public MetaProperty<Currency> currency() {
      return currency;
    }

    /**
     * The meta-property for the {@code dayCount} property.
     * @return the meta-property, not null
     */
    public MetaProperty<DayCount> dayCount() {
      return dayCount;
    }

    /**
     * The meta-property for the {@code dayConvention} property.
     * @return the meta-property, not null
     */
    public MetaProperty<BusinessDayConvention> dayConvention() {
      return dayConvention;
    }

    /**
     * The meta-property for the {@code paymentFrequency} property.
     * @return the meta-property, not null
     */
    public MetaProperty<Frequency> paymentFrequency() {
      return paymentFrequency;
    }

    /**
     * The meta-property for the {@code payAccOnDefault} property.
     * @return the meta-property, not null
     */
    public MetaProperty<Boolean> payAccOnDefault() {
      return payAccOnDefault;
    }

    /**
     * The meta-property for the {@code calendar} property.
     * @return the meta-property, not null
     */
    public MetaProperty<HolidayCalendar> calendar() {
      return calendar;
    }

    /**
     * The meta-property for the {@code stepIn} property.
     * @return the meta-property, not null
     */
    public MetaProperty<Integer> stepIn() {
      return stepIn;
    }

    /**
     * The meta-property for the {@code stubConvention} property.
     * @return the meta-property, not null
     */
    public MetaProperty<StubConvention> stubConvention() {
      return stubConvention;
    }

    //-----------------------------------------------------------------------
    @Override
    protected Object propertyGet(Bean bean, String propertyName, boolean quiet) {
      switch (propertyName.hashCode()) {
        case 575402001:  // currency
          return ((StandardSingleNameConvention) bean).getCurrency();
        case 1905311443:  // dayCount
          return ((StandardSingleNameConvention) bean).getDayCount();
        case 1710876717:  // dayConvention
          return ((StandardSingleNameConvention) bean).getDayConvention();
        case 863656438:  // paymentFrequency
          return ((StandardSingleNameConvention) bean).getPaymentFrequency();
        case -988493655:  // payAccOnDefault
          return ((StandardSingleNameConvention) bean).isPayAccOnDefault();
        case -178324674:  // calendar
          return ((StandardSingleNameConvention) bean).getCalendar();
        case -892367599:  // stepIn
          return ((StandardSingleNameConvention) bean).getStepIn();
        case -31408449:  // stubConvention
          return ((StandardSingleNameConvention) bean).stubConvention;
      }
      return super.propertyGet(bean, propertyName, quiet);
    }

    @Override
    protected void propertySet(Bean bean, String propertyName, Object newValue, boolean quiet) {
      metaProperty(propertyName);
      if (quiet) {
        return;
      }
      throw new UnsupportedOperationException("Property cannot be written: " + propertyName);
    }

  }

  //-----------------------------------------------------------------------
  /**
   * The bean-builder for {@code StandardSingleNameConvention}.
   */
  public static final class Builder extends DirectFieldsBeanBuilder<StandardSingleNameConvention> {

    private Currency currency;
    private DayCount dayCount;
    private BusinessDayConvention dayConvention;
    private Frequency paymentFrequency;
    private boolean payAccOnDefault;
    private HolidayCalendar calendar;
    private int stepIn;
    private StubConvention stubConvention;

    /**
     * Restricted constructor.
     */
    private Builder() {
    }

    /**
     * Restricted copy constructor.
     * @param beanToCopy  the bean to copy from, not null
     */
    private Builder(StandardSingleNameConvention beanToCopy) {
      this.currency = beanToCopy.getCurrency();
      this.dayCount = beanToCopy.getDayCount();
      this.dayConvention = beanToCopy.getDayConvention();
      this.paymentFrequency = beanToCopy.getPaymentFrequency();
      this.payAccOnDefault = beanToCopy.isPayAccOnDefault();
      this.calendar = beanToCopy.getCalendar();
      this.stepIn = beanToCopy.getStepIn();
      this.stubConvention = beanToCopy.stubConvention;
    }

    //-----------------------------------------------------------------------
    @Override
    public Object get(String propertyName) {
      switch (propertyName.hashCode()) {
        case 575402001:  // currency
          return currency;
        case 1905311443:  // dayCount
          return dayCount;
        case 1710876717:  // dayConvention
          return dayConvention;
        case 863656438:  // paymentFrequency
          return paymentFrequency;
        case -988493655:  // payAccOnDefault
          return payAccOnDefault;
        case -178324674:  // calendar
          return calendar;
        case -892367599:  // stepIn
          return stepIn;
        case -31408449:  // stubConvention
          return stubConvention;
        default:
          throw new NoSuchElementException("Unknown property: " + propertyName);
      }
    }

    @Override
    public Builder set(String propertyName, Object newValue) {
      switch (propertyName.hashCode()) {
        case 575402001:  // currency
          this.currency = (Currency) newValue;
          break;
        case 1905311443:  // dayCount
          this.dayCount = (DayCount) newValue;
          break;
        case 1710876717:  // dayConvention
          this.dayConvention = (BusinessDayConvention) newValue;
          break;
        case 863656438:  // paymentFrequency
          this.paymentFrequency = (Frequency) newValue;
          break;
        case -988493655:  // payAccOnDefault
          this.payAccOnDefault = (Boolean) newValue;
          break;
        case -178324674:  // calendar
          this.calendar = (HolidayCalendar) newValue;
          break;
        case -892367599:  // stepIn
          this.stepIn = (Integer) newValue;
          break;
        case -31408449:  // stubConvention
          this.stubConvention = (StubConvention) newValue;
          break;
        default:
          throw new NoSuchElementException("Unknown property: " + propertyName);
      }
      return this;
    }

    @Override
    public Builder set(MetaProperty<?> property, Object value) {
      super.set(property, value);
      return this;
    }

    @Override
    public Builder setString(String propertyName, String value) {
      setString(meta().metaProperty(propertyName), value);
      return this;
    }

    @Override
    public Builder setString(MetaProperty<?> property, String value) {
      super.setString(property, value);
      return this;
    }

    @Override
    public Builder setAll(Map<String, ? extends Object> propertyValueMap) {
      super.setAll(propertyValueMap);
      return this;
    }

    @Override
    public StandardSingleNameConvention build() {
      return new StandardSingleNameConvention(
          currency,
          dayCount,
          dayConvention,
          paymentFrequency,
          payAccOnDefault,
          calendar,
          stepIn,
          stubConvention);
    }

    //-----------------------------------------------------------------------
    /**
     * Sets the {@code currency} property in the builder.
     * @param currency  the new value, not null
     * @return this, for chaining, not null
     */
    public Builder currency(Currency currency) {
      JodaBeanUtils.notNull(currency, "currency");
      this.currency = currency;
      return this;
    }

    /**
     * Sets the {@code dayCount} property in the builder.
     * @param dayCount  the new value, not null
     * @return this, for chaining, not null
     */
    public Builder dayCount(DayCount dayCount) {
      JodaBeanUtils.notNull(dayCount, "dayCount");
      this.dayCount = dayCount;
      return this;
    }

    /**
     * Sets the {@code dayConvention} property in the builder.
     * @param dayConvention  the new value, not null
     * @return this, for chaining, not null
     */
    public Builder dayConvention(BusinessDayConvention dayConvention) {
      JodaBeanUtils.notNull(dayConvention, "dayConvention");
      this.dayConvention = dayConvention;
      return this;
    }

    /**
     * Sets the {@code paymentFrequency} property in the builder.
     * @param paymentFrequency  the new value, not null
     * @return this, for chaining, not null
     */
    public Builder paymentFrequency(Frequency paymentFrequency) {
      JodaBeanUtils.notNull(paymentFrequency, "paymentFrequency");
      this.paymentFrequency = paymentFrequency;
      return this;
    }

    /**
     * Sets the {@code payAccOnDefault} property in the builder.
     * @param payAccOnDefault  the new value, not null
     * @return this, for chaining, not null
     */
    public Builder payAccOnDefault(boolean payAccOnDefault) {
      JodaBeanUtils.notNull(payAccOnDefault, "payAccOnDefault");
      this.payAccOnDefault = payAccOnDefault;
      return this;
    }

    /**
     * Sets the {@code calendar} property in the builder.
     * @param calendar  the new value, not null
     * @return this, for chaining, not null
     */
    public Builder calendar(HolidayCalendar calendar) {
      JodaBeanUtils.notNull(calendar, "calendar");
      this.calendar = calendar;
      return this;
    }

    /**
     * Sets the {@code stepIn} property in the builder.
     * @param stepIn  the new value, not null
     * @return this, for chaining, not null
     */
    public Builder stepIn(int stepIn) {
      JodaBeanUtils.notNull(stepIn, "stepIn");
      this.stepIn = stepIn;
      return this;
    }

    /**
     * Sets the {@code stubConvention} property in the builder.
     * @param stubConvention  the new value
     * @return this, for chaining, not null
     */
    public Builder stubConvention(StubConvention stubConvention) {
      this.stubConvention = stubConvention;
      return this;
    }

    //-----------------------------------------------------------------------
    @Override
    public String toString() {
      StringBuilder buf = new StringBuilder(288);
      buf.append("StandardSingleNameConvention.Builder{");
      buf.append("currency").append('=').append(JodaBeanUtils.toString(currency)).append(',').append(' ');
      buf.append("dayCount").append('=').append(JodaBeanUtils.toString(dayCount)).append(',').append(' ');
      buf.append("dayConvention").append('=').append(JodaBeanUtils.toString(dayConvention)).append(',').append(' ');
      buf.append("paymentFrequency").append('=').append(JodaBeanUtils.toString(paymentFrequency)).append(',').append(' ');
      buf.append("payAccOnDefault").append('=').append(JodaBeanUtils.toString(payAccOnDefault)).append(',').append(' ');
      buf.append("calendar").append('=').append(JodaBeanUtils.toString(calendar)).append(',').append(' ');
      buf.append("stepIn").append('=').append(JodaBeanUtils.toString(stepIn)).append(',').append(' ');
      buf.append("stubConvention").append('=').append(JodaBeanUtils.toString(stubConvention));
      buf.append('}');
      return buf.toString();
    }

  }

  ///CLOVER:ON
  //-------------------------- AUTOGENERATED END --------------------------
}
